package com.volcengine.wafruntime;

import com.volcengine.ApiClient;
import com.volcengine.ApiException;
import com.volcengine.sign.Credentials;
import com.volcengine.waf.model.CheckLLMResponseStreamRequest;
import com.volcengine.waf.model.CheckLLMResponseStreamResponse;
/**
 * Example Code generated by Beijing Volcengine Technology.
 */
public class TestCheckLLMResponseStream {

    public static void main(String[] args)  {

        // 注意示例代码安全，代码泄漏会导致AK/SK泄漏，有极大的安全风险。
        String ak = "YOUR_AK";
        String sk = "YOUR_SK";
        String region = "YOUR_REGION";
        //这是一个超长的字符串，您可以替换成从输入流中读取到的任何内容，提交给SDK进行检测
        String longString = "这是一个超长的字符串，您可以替换成从输入流中读取到的任何内容，提交给SDK进行检测";

        ApiClient apiClient = new ApiClient()
                .setCredentials(Credentials.getCredentials(ak, sk))
                .setRegion(region).setEndpoint("YOUR_ENDPOINT");
        WafApiRuntime api = new WafApiRuntime(apiClient);
        LLMStreamSession session = new LLMStreamSession();
        CheckLLMResponseStreamRequest checkLLMResponseStreamRequest = new CheckLLMResponseStreamRequest();
        checkLLMResponseStreamRequest.setContentType(1);
        checkLLMResponseStreamRequest.setHost("YOUR_HOST");
        checkLLMResponseStreamRequest.setMsgClass(0);
        checkLLMResponseStreamRequest.setRegion(region);
        checkLLMResponseStreamRequest.setUseStream(1);

        int length = longString.length();
        // 这里我们每次输入 9 个字符，直到将整个字符串输入完毕，您可以替换成任意长度的字符，多次调用SDK
        for (int i = 0; i < length; i += 9) {
            int endIndex = Math.min(i + 9, length);
            String subString = longString.substring(i, endIndex);
            checkLLMResponseStreamRequest.setContent(subString);
            if (endIndex == length) {
                checkLLMResponseStreamRequest.setUseStream(2); // 最后一次调用时，将use_stream设置为2，代表输入流结束
            }

            try {
                // 复制代码运行示例，请自行打印API返回值。
                CheckLLMResponseStreamResponse resp = api.checkLLMResponseStream(checkLLMResponseStreamRequest , session);
                if (resp == null) {
                    System.out.println("resp is null");
                    continue;
                }
                System.out.println(resp);

            } catch (ApiException e) {
                // 复制代码运行示例，请自行打印API错误信息。
                System.out.println(e.getResponseBody());
                return;
            }

        }
    }

}

